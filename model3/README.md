# ERAV3_Assignment7: model-3 - *final model*


### Model Summary
```
----------------------------------------------------------------
        Layer (type)               Output Shape         Param #
================================================================
            Conv2d-1           [-1, 10, 26, 26]              90
              ReLU-2           [-1, 10, 26, 26]               0
       BatchNorm2d-3           [-1, 10, 26, 26]              20
           Dropout-4           [-1, 10, 26, 26]               0
            Conv2d-5           [-1, 16, 24, 24]           1,440
              ReLU-6           [-1, 16, 24, 24]               0
       BatchNorm2d-7           [-1, 16, 24, 24]              32
           Dropout-8           [-1, 16, 24, 24]               0
            Conv2d-9            [-1, 8, 22, 22]           1,152
             ReLU-10            [-1, 8, 22, 22]               0
      BatchNorm2d-11            [-1, 8, 22, 22]              16
          Dropout-12            [-1, 8, 22, 22]               0
        MaxPool2d-13            [-1, 8, 11, 11]               0
           Conv2d-14             [-1, 16, 9, 9]           1,152
             ReLU-15             [-1, 16, 9, 9]               0
      BatchNorm2d-16             [-1, 16, 9, 9]              32
          Dropout-17             [-1, 16, 9, 9]               0
           Conv2d-18             [-1, 16, 7, 7]           2,304
             ReLU-19             [-1, 16, 7, 7]               0
      BatchNorm2d-20             [-1, 16, 7, 7]              32
          Dropout-21             [-1, 16, 7, 7]               0
           Conv2d-22             [-1, 10, 5, 5]           1,440
             ReLU-23             [-1, 10, 5, 5]               0
      BatchNorm2d-24             [-1, 10, 5, 5]              20
          Dropout-25             [-1, 10, 5, 5]               0
AdaptiveAvgPool2d-26             [-1, 10, 1, 1]               0
           Conv2d-27             [-1, 10, 1, 1]             100
================================================================
Total params: 7,830
Trainable params: 7,830
Non-trainable params: 0
----------------------------------------------------------------
Input size (MB): 0.00
Forward/backward pass size (MB): 0.68
Params size (MB): 0.03
Estimated Total Size (MB): 0.72
----------------------------------------------------------------
```

### Model Input Sizes, Output Sizes and Receptive Field Computation
```
# Layer-wise Analysis of the Neural Network
| Layer              | Input Size | Output Size | Input Channels | Output Channels | Kernel Size | Stride | Padding | Receptive Field |
|---------------------|------------|-------------|----------------|-----------------|-------------|--------|---------|----------------|
| Input              | 28x28      | 28x28       | 1              | 1               | -           | -      | -       | 1              |
| Conv1 + ReLU + BN  | 28x28      | 26x26       | 1              | 10              | 3x3         | 1      | 0       | 3              |
| Conv2 + ReLU + BN  | 26x26      | 24x24       | 10             | 16              | 3x3         | 1      | 0       | 5              |
| Conv3 + ReLU + BN  | 24x24      | 22x22       | 16             | 8               | 3x3         | 1      | 0       | 7              |
| MaxPool (Transition1) | 22x22   | 11x11       | 8              | 8               | 2x2         | 2      | 0       | 8              |
| Conv4 + ReLU + BN  | 11x11      | 9x9         | 8              | 16              | 3x3         | 1      | 0       | 12             |
| Conv5 + ReLU + BN  | 9x9        | 7x7         | 16             | 16              | 3x3         | 1      | 0       | 16             |
| Conv6 + ReLU + BN  | 7x7        | 5x5         | 16             | 10              | 3x3         | 1      | 0       | 20             |
| GAP                | 5x5        | 1x1         | 10             | 10              | 5x5         | -      | -       | 28             |
| Conv7              | 1x1        | 1x1         | 10             | 10              | 1x1         | 1      | 0       | 28             |
```


### Target:
  1. Under 8000 parameters and under 15 epochs, consistently reach test accuracy of 99.4% at least three times.

### Results:
  1. Parameters: 7,830
  2. Best Train Accuracy within epoch 15: 98.75% (epoch 15)
  3. Best Test Accuracy within epoch 15: 99.45% (epoch 13)
  4. Reached 99.45% at epoch 12 and at epoch 13, 14, 15 were 99.43%, 99.44% and 99.45% respectively.

### Analysis:
  1. Upon adding image augmentation techniques like rotation and affine rotation, the model was further underfitting now.
  2. Modified the number of channels in each layer multiple times, played with different learning rates but finally found that at almost every network with number of parameters ranging from 7500 to 8000, at epoch 7, 8, 9, 10 it reaches test accuracy of 99.25-99.40 but after that it does not improve significantly.
  3. Finally, with a simple StepLR scheduler and after 9th epoch, the lr got updated and it reached the desired test accuracies(>= 99.40%) consistently.
  4. Then reducing the dropout to 0.01 has improved the test accuracy to a large extent.
  4. A scheduler would have yielded the expected result with the previous version of model itself.   



### Training Logs
```
---------------------------
device:  cpu
---------------------------
--------------------------------------------
EPOCH: 0
Learning Rate = 0.010000
Loss=0.1858264058828354 Batch_id=400 Accuracy=82.74:  85%|██████████████████████████████████████████████████████████████████████████████████████████████▋                | 400/469 [00:45<00:07,  9.48it/s]Loss=0.2017694115638733 Batch_id=468 Accuracy=84.61: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:52<00:00,  9.00it/s]

Training set: Average loss: 0.2018, Accuracy: 50767/60000 (84.61%)


Test set: Average loss: 0.0828, Accuracy: 9755/10000 (97.55%)

--------------------------------------------
--------------------------------------------
EPOCH: 1
Learning Rate = 0.010000
Loss=0.08703920245170593 Batch_id=468 Accuracy=96.57: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:47<00:00,  9.95it/s]

Training set: Average loss: 0.0870, Accuracy: 57940/60000 (96.57%)


Test set: Average loss: 0.0466, Accuracy: 9874/10000 (98.74%)

--------------------------------------------
--------------------------------------------
EPOCH: 2
Learning Rate = 0.010000
Loss=0.052114337682724 Batch_id=468 Accuracy=97.27: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.06it/s]

Training set: Average loss: 0.0521, Accuracy: 58362/60000 (97.27%)


Test set: Average loss: 0.0424, Accuracy: 9871/10000 (98.71%)

--------------------------------------------
--------------------------------------------
EPOCH: 3
Learning Rate = 0.010000
Loss=0.03109481744468212 Batch_id=468 Accuracy=97.68: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.01it/s]

Training set: Average loss: 0.0311, Accuracy: 58610/60000 (97.68%)


Test set: Average loss: 0.0289, Accuracy: 9909/10000 (99.09%)

--------------------------------------------
--------------------------------------------
EPOCH: 4
Learning Rate = 0.010000
Loss=0.09712305665016174 Batch_id=468 Accuracy=97.83: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:48<00:00,  9.65it/s]

Training set: Average loss: 0.0971, Accuracy: 58698/60000 (97.83%)


Test set: Average loss: 0.0294, Accuracy: 9913/10000 (99.13%)

--------------------------------------------
--------------------------------------------
EPOCH: 5
Learning Rate = 0.010000
Loss=0.10832753032445908 Batch_id=468 Accuracy=98.00: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.13it/s]

Training set: Average loss: 0.1083, Accuracy: 58799/60000 (98.00%)


Test set: Average loss: 0.0219, Accuracy: 9936/10000 (99.36%)

--------------------------------------------
--------------------------------------------
EPOCH: 6
Learning Rate = 0.010000
Loss=0.046284738928079605 Batch_id=468 Accuracy=98.10: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.07it/s]

Training set: Average loss: 0.0463, Accuracy: 58861/60000 (98.10%)


Test set: Average loss: 0.0247, Accuracy: 9921/10000 (99.21%)

--------------------------------------------
--------------------------------------------
EPOCH: 7
Learning Rate = 0.010000
Loss=0.06394660472869873 Batch_id=468 Accuracy=98.20: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.07it/s]

Training set: Average loss: 0.0639, Accuracy: 58920/60000 (98.20%)


Test set: Average loss: 0.0241, Accuracy: 9925/10000 (99.25%)

--------------------------------------------
--------------------------------------------
EPOCH: 8
Learning Rate = 0.010000
Loss=0.028944773599505424 Batch_id=468 Accuracy=98.27: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [01:02<00:00,  7.45it/s]

Training set: Average loss: 0.0289, Accuracy: 58962/60000 (98.27%)


Test set: Average loss: 0.0206, Accuracy: 9936/10000 (99.36%)

--------------------------------------------
--------------------------------------------
EPOCH: 9
Learning Rate = 0.010000
Loss=0.030571823939681053 Batch_id=468 Accuracy=98.40: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:47<00:00,  9.80it/s]

Training set: Average loss: 0.0306, Accuracy: 59042/60000 (98.40%)


Test set: Average loss: 0.0214, Accuracy: 9934/10000 (99.34%)

--------------------------------------------
--------------------------------------------
EPOCH: 10
Learning Rate = 0.001000
Loss=0.04686020687222481 Batch_id=468 Accuracy=98.52: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.02it/s]

Training set: Average loss: 0.0469, Accuracy: 59113/60000 (98.52%)


Test set: Average loss: 0.0184, Accuracy: 9939/10000 (99.39%)

--------------------------------------------
--------------------------------------------
EPOCH: 11
Learning Rate = 0.001000
Loss=0.06281571835279465 Batch_id=468 Accuracy=98.66: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:51<00:00,  9.10it/s]

Training set: Average loss: 0.0628, Accuracy: 59197/60000 (98.66%)


Test set: Average loss: 0.0176, Accuracy: 9945/10000 (99.45%)

--------------------------------------------
--------------------------------------------
EPOCH: 12
Learning Rate = 0.001000
Loss=0.015242506749927998 Batch_id=468 Accuracy=98.70: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:52<00:00,  9.01it/s]

Training set: Average loss: 0.0152, Accuracy: 59222/60000 (98.70%)


Test set: Average loss: 0.0177, Accuracy: 9943/10000 (99.43%)

--------------------------------------------
--------------------------------------------
EPOCH: 13
Learning Rate = 0.001000
Loss=0.03335175663232803 Batch_id=468 Accuracy=98.69: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:46<00:00, 10.11it/s]

Training set: Average loss: 0.0334, Accuracy: 59216/60000 (98.69%)


Test set: Average loss: 0.0177, Accuracy: 9944/10000 (99.44%)

--------------------------------------------
--------------------------------------------
EPOCH: 14
Learning Rate = 0.001000
Loss=0.030221274122595787 Batch_id=468 Accuracy=98.75: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:52<00:00,  8.97it/s]

Training set: Average loss: 0.0302, Accuracy: 59252/60000 (98.75%)


Test set: Average loss: 0.0178, Accuracy: 9945/10000 (99.45%)

--------------------------------------------
--------------------------------------------
EPOCH: 15
Learning Rate = 0.001000
Loss=0.02901366539299488 Batch_id=468 Accuracy=98.69: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:58<00:00,  8.05it/s]

Training set: Average loss: 0.0290, Accuracy: 59212/60000 (98.69%)


Test set: Average loss: 0.0170, Accuracy: 9943/10000 (99.43%)

--------------------------------------------
--------------------------------------------
EPOCH: 16
Learning Rate = 0.001000
Loss=0.022328704595565796 Batch_id=468 Accuracy=98.78: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [01:04<00:00,  7.22it/s]

Training set: Average loss: 0.0223, Accuracy: 59267/60000 (98.78%)


Test set: Average loss: 0.0176, Accuracy: 9945/10000 (99.45%)

--------------------------------------------
--------------------------------------------
EPOCH: 17
Learning Rate = 0.001000
Loss=0.02602461166679859 Batch_id=468 Accuracy=98.79: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:53<00:00,  8.69it/s]

Training set: Average loss: 0.0260, Accuracy: 59274/60000 (98.79%)


Test set: Average loss: 0.0174, Accuracy: 9953/10000 (99.53%)

--------------------------------------------
--------------------------------------------
EPOCH: 18
Learning Rate = 0.001000
Loss=0.012702644802629948 Batch_id=468 Accuracy=98.80: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:52<00:00,  8.95it/s]

Training set: Average loss: 0.0127, Accuracy: 59282/60000 (98.80%)


Test set: Average loss: 0.0171, Accuracy: 9948/10000 (99.48%)

--------------------------------------------
--------------------------------------------
EPOCH: 19
Learning Rate = 0.001000
Loss=0.015984661877155304 Batch_id=468 Accuracy=98.75: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████| 469/469 [00:54<00:00,  8.60it/s]

Training set: Average loss: 0.0160, Accuracy: 59250/60000 (98.75%)


Test set: Average loss: 0.0171, Accuracy: 9946/10000 (99.46%)

--------------------------------------------
(era3_assignments) sravan@sravan-latitude-3410 ~/Personal/Courses/ERA3/Assignment7/ERAV3_Assignment7/model3 (main)$ 
```